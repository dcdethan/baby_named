<!--pages/result/result.wxml-->
<view class="container">
  <view class="header">
    <text class="title">起名结果</text>
    <text class="subtitle">点击名字查看详细分析</text>
  </view>

  <!-- 八字信息 -->
  <view class="bazi-card card" wx:if="{{bazi}}">
    <view class="card-title">八字五行分析</view>
    <view class="bazi-content">
      <view class="bazi-row">
        <view class="bazi-item">
          <text class="bazi-label">年柱</text>
          <text class="bazi-value">{{bazi.year}}</text>
        </view>
        <view class="bazi-item">
          <text class="bazi-label">月柱</text>
          <text class="bazi-value">{{bazi.month}}</text>
        </view>
        <view class="bazi-item">
          <text class="bazi-label">日柱</text>
          <text class="bazi-value">{{bazi.day}}</text>
        </view>
        <view class="bazi-item">
          <text class="bazi-label">时柱</text>
          <text class="bazi-value">{{bazi.hour}}</text>
        </view>
      </view>
      <!-- 五行分析结果 -->
      <view class="wuxing-result" wx:if="{{bazi.wuxingResult}}">
        <text class="wuxing-title">{{bazi.wuxingResult}}</text>
      </view>
      <!-- 五行详细解释 -->
      <view class="wuxing-explanation" wx:if="{{bazi.wuxingExplanation}}">
        <text class="explanation-text">{{bazi.wuxingExplanation}}</text>
      </view>
    </view>
  </view>

  <!-- 单字候选 -->
  <view class="chars-section" wx:if="{{singleChars.length > 0}}">
    <view class="card-title">点击下面字查看详情</view>
    <view class="chars-grid">
      <view
        class="char-card {{expandedType === 'single' && expandedIndex === index ? 'expanded' : ''}}"
        wx:for="{{singleChars}}"
        wx:key="char"
        data-index="{{index}}"
        data-type="single"
        bindtap="onCharTap"
      >
        <view class="char-main">
          <text class="char-text">{{item.char}}</text>
          <text class="char-pinyin">{{item.pinyin}}</text>
          <view class="char-wuxing" wx:if="{{item.wuxing}}">{{item.wuxing}}</view>
        </view>

        <!-- 展开的名字分析 -->
        <view class="char-detail" wx:if="{{expandedType === 'single' && expandedIndex === index}}">
          <view class="detail-name">
            <text class="full-name">{{item.fullName}}</text>
            <text class="full-pinyin">{{item.fullPinyin}}</text>
          </view>
          <view class="detail-analysis">{{item.analysis}}</view>

          <!-- 三字名扩展 -->
          <view class="expand-section">
            <view class="expand-title">基于此字的三字名推荐</view>
            <view class="expand-loading" wx:if="{{loadingExpand && !expandedChars[index]}}">
              <text>正在生成三字名...</text>
            </view>
            <view class="expand-names" wx:elif="{{expandedChars[index] && expandedChars[index].length > 0}}">
              <view class="expand-item" wx:for="{{expandedChars[index]}}" wx:key="char" wx:for-item="expandItem">
                <view class="expand-name-row">
                  <text class="expand-name">{{expandItem.fullName}}</text>
                  <text class="expand-pinyin">{{expandItem.fullPinyin}}</text>
                  <view class="expand-wuxing">{{expandItem.wuxing}}</view>
                </view>
                <view class="expand-analysis">{{expandItem.analysis}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 双字候选 -->
  <view class="chars-section" wx:if="{{doubleChars.length > 0}}">
    <view class="card-title">双字候选（姓+2字）</view>
    <view class="chars-grid double-grid">
      <view
        class="char-card double-card {{expandedType === 'double' && expandedIndex === index ? 'expanded' : ''}}"
        wx:for="{{doubleChars}}"
        wx:key="char"
        data-index="{{index}}"
        data-type="double"
        bindtap="onCharTap"
      >
        <view class="char-main">
          <text class="char-text double-text">{{item.char}}</text>
          <text class="char-pinyin">{{item.pinyin}}</text>
          <view class="char-wuxing">{{item.wuxing}}</view>
          <text class="char-hint" wx:if="{{expandedType !== 'double' || expandedIndex !== index}}">点击查看详情</text>
        </view>

        <!-- 展开的名字分析 -->
        <view class="char-detail" wx:if="{{expandedType === 'double' && expandedIndex === index}}">
          <view class="detail-name">
            <text class="full-name">{{item.fullName}}</text>
            <text class="full-pinyin">{{item.fullPinyin}}</text>
          </view>
          <view class="detail-analysis">{{item.analysis}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部按钮 -->
  <view class="bottom-actions">
    <button class="btn-secondary" bindtap="onBack">返回重新起名</button>
    <button class="btn-primary" bindtap="onShare">分享结果</button>
  </view>
</view>
